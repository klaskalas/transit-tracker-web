<p-card
  class="transit-card"
  [class.completed]="line.completed"
  (click)="previewLine()">
  <div class="card-accent" [style.background-color]="line.color"></div>
  <div class="card-header">
    <div class="type-badge" [style.background-color]="line.color">
      <fa-icon [icon]="getPrimeTypeIcon(line.routeType)"></fa-icon>
    </div>
    <div class="line-badge" [style.background-color]="line.color">
      {{ line.shortName }}
    </div>
    <div class="line-main">
      <div class="line-title">
        <span class="line-name">{{ line.longName || 'Line ' + line.shortName }}</span>
      </div>
      <div class="line-meta">
        <span class="meta-pill">
          <i class="pi pi-map-marker"></i>
          {{ line.region || line.agency?.name }}
        </span>
        <span class="meta-pill">
          {{ line.agency?.countryCode }}
        </span>
        <span class="meta-pill">
          {{ getTypeLabel(line.routeType) }}
        </span>
      </div>
    </div>
    @if (line.completed) {
      <div class="status-pill">
        <i class="pi pi-check"></i>
        Visited
      </div>
    }
  </div>

  <div class="line-stats">
    <div class="stat-item">
      <i class="pi pi-sitemap"></i>
      <span>{{ getStopCount(line.points, line.stopCount) }} stops</span>
    </div>
    <div class="stat-item">
      <i class="pi pi-compass"></i>
      <span>{{ getDistanceKm(line) }} km</span>
    </div>
    <div class="stat-item">
      <i class="pi pi-bolt"></i>
      <span>{{ line.gtfsRouteId }}</span>
    </div>
  </div>

  <div class="card-footer">
    <button
      pButton
      [outlined]="line.completed"
      [severity]="line.completed ? 'secondary' : 'primary'"
      [icon]="line.completed ? 'pi pi-check' : 'pi pi-plus'"
      [ngClass]="{ 'is-completed': line.completed }"
      (click)="$event.stopPropagation(); onToggleCompletion()"
      class="completion-button"
      type="button"
    >
      {{ line.completed ? 'Visited' : 'Mark as Visited' }}
    </button>
  </div>
</p-card>
